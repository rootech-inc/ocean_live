{% extends 'base.html' %}

{% block body %}
    <div class="card-header">
        <div class="w-100 d-flex flex-wrap justify-content-between align-items-center">
                                <div class="w-50"><strong class="card-title">Entities</strong></div>
                                <div class="w-50 d-flex flex-wrap justify-content-end">
                                    <button id="new_location_button" style="margin-right: 5px" class="btn btn-sm btn-info"><i class="fa fa-plus"></i> New Location</button>
                                    <button id="entity_type" class="btn btn-info btn-sm"><i class="fa fa-plus"></i> Entity Type</button>
                                </div>
                            </div>
    </div>

    <div class="card-body overflow-auto">
        <div class="container p-2">
            <div class="row">
                 <!-- company -->
                <div class="col-sm-4 col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <div class="w-100 d-flex align-items-center">
                                <strong class="card-title">Company</strong>
                                <button id="add_company" class="btn btn-info btn-sm ms-auto"><i class="fa fa-plus"></i> Add Company</button>
                            </div>
                            
                        </div>

                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm mb-0">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="companies-table-body">
                                        <!-- comapanies will be rendered here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
              <!-- entity-->
                <div class="col-sm-4 col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <div class="w-100 d-flex align-items-center">
                                <strong class="card-title">Entity Type</strong>
                                <button id="add_entity" class="btn btn-info btn-sm ms-auto"><i class="fa fa-plus"></i> Add Entity</button>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm mb-0">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>company</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="entities-table-body">
                                        <!-- entities -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="card">

                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="mb-0 datatable">
                                    <thead>
                                        <tr><th>NAME</th><th>ADDRESS</th><th>Entity</th><th>EVAT</th><th>ACTION</th></tr>
                                    </thead>
                                    <tbody>
                                        
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        function newLocation() {
            let form ='';
            form += fom.number('code','Location Code related to software used',true)
            form += fom.text('descr','Location Description',true)
            form += fom.text('server_ip','Server IP Address',true)
            form += fom.text('server_location','Server Physical Location',true)
            form += fom.text('db','Database Name',true)
            form += fom.text('db_user','Database User',true)
            form += fom.password('db_password','<PASSWORD>',true)
            form += fom.select('type','Location Type',true,[{'pk':'1','name':'Main'},{'pk':'2','name':'Branch'}])



            Swal.fire({
              title: 'NEW LOCATION',
              html: `
                <input id="code" type="number" autocomplete="off" placeholder="CODE" class="form-control rounded-0 mb-2">
                <select name="type" id="type" class="form-control rounded-0 mb-2">

                </select>
                <input id="descr" type="text" autocomplete="off" placeholder="DESCRIPTION" class="form-control rounded-0 mb-2">
                <input id="server_ip" type="text" autocomplete="off" placeholder="SERVER IP ADDRESS" class="form-control rounded-0 mb-2">
                <input id="server_location" autocomplete="off" type="text" placeholder="SERVER PHYSICAL LOCATION" class="form-control rounded-0 mb-2">
                <input id="db" autocomplete="off" placeholder="DATABASE NAME" type="text" class="form-control rounded-0 mb-2">
                <input id="db_user" autocomplete="off" class="form-control rounded-0 mb-2" placeholder="DB USER">
                <input id="db_password" type="password" autocomplete="off" class="form-control rounded-0 mb-2" placeholder="DB PASSWORD">

              `,

              focusConfirm: false,
              confirmButtonText: 'Submit',
                showCancelButton: true,
                cancelButtonText:'CANCEL',
                confirmButtonColor:'#19541b',
              preConfirm: () => {
                const server_ip = document.getElementById('server_ip').value
                const server_location = document.getElementById('server_location').value;
                const code = document.getElementById('code').value;
                const descr = document.getElementById('descr').value;
                const db = document.getElementById('db').value;
                const db_user = document.getElementById('db_user').value;
                const db_password = document.getElementById('db_password').value;

                if (!server_ip || !server_location || !code || !descr || !db || !db_user || !db_password) {
                  Swal.showValidationMessage(`Please fill all fields`)
                }

                return {server_ip: server_ip, server_location: server_location, code: code, descr: descr, db_user:db_user,db_password:db_password,db:db}
              },
            }).then((result) => {
                  if (result.isConfirmed) {
                      let data = result.value
                      data['owner'] = $('#mypk').val()
                      let payload = {
                          'module':'location',
                          data:data
                      };
                      let response = api.call('PUT',payload,'/adapi/')
                      kasa.info(response['message'])
                      console.table(payload)
                    console.log(result.value)
                  }
                })
        }

        async function setBusinessUnit(location) {
            let form = "";
            let et_load = {
                module: 'entity_type',
                data: {}
            }

            await api.v2('VIEW', et_load, '/adapi/').then(response => {
                if(anton.IsRequest(response)){
                    let ets = response.message;
                    let etfo = [];
                    for(let e = 0; e < ets.length; e++){
                        etfo.push({
                            'val':ets[e].pk,
                            'desc':ets[e].name
                        })
                    }
                    form += fom.selectv2('entity_type', etfo, '',true)
                    amodal.setTitleText("SET ENTITY TYPE")
                    amodal.setBodyHtml(form)
                    amodal.setFooterHtml(`<button id="change_loc_entity" class="btn btn-success w-100">CHANGE</button>`)
                    amodal.show()
                    $('#change_loc_entity').click(async function () {
                        let ids = ['mypk', 'entity_type'];
                        if (anton.validateInputs(ids)) {
                            let payload = {
                                'module': 'change_entity_type',
                                data: anton.Inputs(ids)
                            };
                            payload['data']['loc_pk'] = location

                            await api.v2('PATCH', payload, '/adapi/').then(resp => {
                                if (anton.IsRequest(resp)) {
                                    kasa.confirm(resp.message,1,'here')
                                } else {
                                    kasa.response(resp)
                                }
                            })
                        }
                    })
                } else {
                    kasa.response(response)
                }
            })
        }


        function setEvat(location) {

            let payload = {
                'module':'evat_credentials',
                'data':{}
            }

            let response = api.call('VIEW',payload,'/adapi/');

            if(response['status_code'] === 200){

                let keys = response['message'];

                if(keys.length > 0){
                    let ops = {}
                    for (let i = 0; i < keys.length; i++) {
                        let key = keys[i]
                        ops[key['pk']] = key['server_location']
                    }
                    Swal.fire({
                      title: 'CHANGE EVAT CREDENTIAL',
                      input: 'select',
                      inputOptions: ops,
                      inputPlaceholder: 'Select an option',
                      showCancelButton: true,
                      inputValidator: (value) => {
                        return new Promise((resolve) => {
                          if (value !== '') {
                            resolve();
                          } else {
                            resolve('Please select an option');
                          }
                        })
                      }
                    }).then((result) => {
                      if (result.isConfirmed) {
                          let data = {
                              'evat_key':result.value,
                              'loc_key':location
                          };
                          let payload = {
                              'module':'change_evat_engine',
                              data:data
                          };

                          let response = api.call('PATCH',payload,'/adapi/')
                          kasa.info(response['message'])
                      }
                    });

                } else {
                    kasa.info("CREATE EVAT CREDENTIALS")
                }

            } else {
                kasa.error(`CANNOT LOAD CREDENTIALS : ${response['message']}`)
            }


        }

        function deleteLocation(pk) {
            let payload = {
                'module':'location',
                data: {
                    'pk':pk
                }
            }

            if(confirm("ARE YOU SURE")){
                kasa.confirm(
                    api.call('DELETE',payload,'/adapi/')['message'],1,'/company/locations/'
                )
            }

        }
       
        $(document).ready(function (){
            loadCompanies();
            loadEntities();
            // Dropdown menu handlers for company actions
            $(document).on('click', '.delete-company', async function () {
                const assetNo = $(this).data('asset-no');
                let payload = {
                    'module': 'company',
                    data: {
                        'pk': assetNo
                    }
                };
                await api.v2('DELETE', payload, '/adapi/').then(response => {
                    if (anton.IsRequest(response)) {
                        kasa.info(response.message);
                    } else {
                        kasa.error(response.message);
                    }
                }).catch(error => {
                    kasa.error(`Error: ${error}`);
                }).finally(
                    () => loadCompanies()
                )

            });

            // update company form 
           $(document).on('click', '.update-company', async function () {
                    const assetNo = $(this).data('asset-no');
                    // Fetch the company data by pk
                    let response = await api.v2('VIEW', {module: 'company', data: {pk: assetNo}}, '/adapi/');
                    console.log("response ", response)
                    if (anton.IsRequest(response) && response.message) {
                        const company = response.message;

                        let formHtml = `
                            <form id="update-company-form" >
                                <input type="hidden" name="pk" id="pk" value="${company.pk}">
                                <div class="mb-3">
                                    <label for="companyName" class="form-label">Company Name</label>
                                    <input type="text" class="form-control" id="companyName" name="companyName" value="${company.name || ''}" required>
                                </div>
                                <div class="mb-3">
                                    <label for="companyAddress" class="form-label">Company Address</label>
                                    <input type="text" class="form-control" id="companyAddress" name="companyAddress" value="${company.address || ''}" required>
                                </div>
                                <div class="mb-3">
                                    <label for="companyEmail" class="form-label">Company Email</label>
                                    <input type="email" class="form-control" id="companyEmail" name="companyEmail" value="${company.email || ''}" required>
                                </div>
                                <div class="mb-3">
                                    <label for="companyPhone" class="form-label">Company Phone</label>
                                    <input type="tel" class="form-control" id="companyPhone" name="companyPhone" value="${company.phone || ''}" required>
                                </div>
                            </form>
                        `;

                        amodal.setTitleText("UPDATE COMPANY");
                        amodal.setBodyHtml(formHtml);
                        amodal.setFooterHtml(`<button id="save_company_update" class="btn btn-success w-100">SAVE</button>`);
                        amodal.show();
                        amodal.setSIZE('L');

                        
                    } else {
                        kasa.error("Failed to load company data.");
                    }
            });
      

            // update company button
            // Save handler (optional, for completeness)
             $(document).on('click', '#save_company_update', async function () {
            let ids = ['companyName', 'companyAddress', 'companyEmail', 'companyPhone', 'pk'];
            if (anton.validateInputs(ids)) {
                let data = {};
                ids.forEach(id => {
                    data[id] = $(`#${id}`).val();
                });
                
                let payload = {
                    module: 'company',
                    data: data
                };
                try {
                    let updateResp = await api.v2('PATCH', payload, '/adapi/');
                    if (anton.IsRequest(updateResp)) {
                        kasa.info(updateResp.message);
                        amodal.hide();
                    } else {
                        kasa.error(updateResp.message);
                    }
                } catch (error) {
                    kasa.error(`Error: ${error}`);
                }
                finally {
                    loadCompanies();
                }
            } else {
                kasa.error("Invalid inputs");
            }
        });

             // Dropdown menu handlers for entity actions
            $(document).on('click', '.delete-entity', async function () {
                const assetNo = $(this).data('asset-no');
                let payload = {
                    'module': 'entity_type',
                    data: {
                        'pk': assetNo
                    }
                };
                console.log(payload);
                api.v2('DELETE', payload, '/adapi/').then(response => {
                    if (anton.IsRequest(response)) {
                        kasa.info(response.message);
                        console.log("response ", response);
                    } else {
                        kasa.error(response.message); 
                        console.error("error ", response);
                    }
                }).catch(error => {
                    kasa.error(`Error: ${error}`);
                }).finally(
                    () => loadEntities()
                )
                 
                    
            });
            $(document).on('click', '.update-entity', async function () {
                        const assetNo = $(this).data('asset-no');
                        // Fetch the entity data by pk
                        let entityResp = await api.v2('VIEW', {'module': 'entity_type', 'data': {"pk": assetNo}}, '/adapi/');
                        if (anton.IsRequest(entityResp) && entityResp.message && entityResp.message.length > 0) {
                            const entity = entityResp.message[0];
                           

                            // Fetch all companies
                            let companyResp = await api.call('VIEW', {'module': 'company', 'data': {}}, '/adapi/');
                            let formHtml = `
                                        <form id="update-entity-form">
                                            <input type="hidden" name="pk" value="${entity.pk}">
                                            <div class="mb-3">
                                                <label for="entity_name" class="form-label">Name</label>
                                                <input type="text" class="form-control" id="entity_name" name="name" value="${entity.name}" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="entity_descr" class="form-label">Description</label>
                                                <textarea class="form-control" id="entity_descr" name="descr" rows="3" required>${entity.descr}</textarea>
                                            </div>
                                    `;

                                    // Add the selectv2-generated select
                                    if (anton.IsRequest(companyResp)) {
                                        let companies = companyResp.message;
                                        let companyOptions = [];
                                        if (companies.length > 0) {
                                            companyOptions = companies.map(c => ({
                                                val: c.pk,
                                                desc: c.name,
                                                // mark the current object as selected
                                                select : (String(c.pk) === String(entity.company_pk)) ? "selected" : "" 
                                            }));
                                        }
                                        formHtml += fom.selectv2('company', companyOptions, 'Choose a company', true);
                                    } else {
                                        kasa.error("Failed to load companies");
                                    }

                                    formHtml += `</form>`;

                                    amodal.setTitleText("UPDATE ENTITY TYPE");
                                    amodal.setBodyHtml(formHtml);
                                    amodal.setFooterHtml(`<button id="update_entity_type" data-asset-no=${assetNo} class="btn btn-success w-100">Update</button>`);
                                    amodal.show();
                                    amodal.setSIZE('L');

                                    // Set the selected value after rendering
                                    setTimeout(() => {
                                        $('#company').val(entity.company_pk);
                                    }, 100);
                        } else {
                            kasa.error("Failed to load entity data.");
                        }       
            }); 
            // click handler for the update entity type button
            // This is the click handler for the update entity type button
             $(document).on("click", '#update_entity_type', async function () {
                            const assetNo = $(this).data('asset-no');
                            console.log(assetNo, "in save ")
                            let ids = ["entity_descr", "entity_name", "company"];
                                try {
                                    if (anton.validateInputs(ids)) {
                                        let data = {};
                                        data["entity_pk"] = assetNo
                                        ids.forEach(id => {
                                            data[id] = $(`#${id}`).val();
                                        });
                                      
                                        let payload = {
                                            module: "entity_type",
                                            data: data
                                        };
                                        await api.v2("PATCH", payload, "/adapi/").then(
                                            response => {
                                                kasa.info(response.message)
                                            }
                                        ).catch(error => {kasa.info(error)}).finally(
                                            () => { amodal.hide(); loadEntities()}
                                            
                                        )
                                    }
                                } catch (error) {
                                    console.error(error)
                                    kasa.error("invalid inputs");
                                }
                            
                        });
            
            
            
            // delete company button
            $('#delete_company').click(function () {
                let companyPk = $(this).data('pk');
                console.log(companyPk);
            });

            $('#new_location_button').click(function (){
                newLocation()
            });

            $('#add_entity').click(function() {
                let form = "";
                form += fom.text('entity_type_name', 'Entity Type Name', true)
                form += fom.textarea('entity_type_descr', 3, true)

                // fetch comany entity types from the API
                let response = api.call('VIEW', {'module': 'company', 'data': {}}, '/adapi/')
                if (anton.IsRequest(response)) {
                    let entityTypes = response.message;
                    // does not show if no entity types are available
                    if (entityTypes.length > 0) {
                        let entityTypeOptions = entityTypes.map(et => ({
                            val: et.pk,
                            desc: et.name,
                            
                        }));
                        form += fom.selectv2(
                            'company',
                            entityTypeOptions,
                            'Choose a company',
                            true
                        );
                    }
                } else {
                kasa.error("Failed to load entity types");
                }
                amodal.setTitleText("NEW ENTITY TYPE")
                amodal.setBodyHtml(form)
                amodal.setFooterHtml(`<button id="save_entity_type" class="btn btn-success w-100">SAVE</button>`)
                amodal.show()

                $('#save_entity_type').click(async function () {
                        let ids = ['entity_type_name', 'entity_type_descr', 'company'];

                        if (anton.validateInputs(ids)) {
                            let payload = {
                                'module': 'entity_type',
                                data: anton.Inputs(ids)
                            };
                            console.table(payload);

                            try {
                                let response = await api.call('PUT', payload, '/adapi/');
                                kasa.info(response['message']);
                                loadEntities()
                            } catch (error) {
                                console.error(error);
                                kasa.error("Failed to save entity type.");
                            }

                            amodal.hide();
                        } else {
                            kasa.error("Invalid Form");
                }
        });

            })

            $('.sync_inventory').on('click', async function (event) {
                event.preventDefault(); // Prevent the default action (e.g., navigating the link)

                // Get the value of the custom attribute `entity-pk`
                let entityPkValue = $(this).attr('entity-pk');

                let payload = {
                    module: 'sync_inventory',
                    'data': {
                        enityt_pk: entityPkValue
                    }
                }

                loader.show()

                await api.v2('PUT', payload, '/adapi/').then(response => {
                    if (anton.IsRequest(response)) {
                        kasa.confirm(response.message, 1, 'here')
                    } else {
                        kasa.response(response)
                    }
                    loader.hide()
                }).catch(error => {
                    kasa.error(error)
                    loader.hide()
                })

            });

            $(document).on('click', '#save_entity_type', async function () {
                let entityTypeName = $("#entityTypeName").val().trim();
                let description = $("#entityDescription").val().trim();

                if (entityTypeName === "") {
                    kasa.error("Entity Type Name is required.");
                    return;
                }

                let payload = {
                    module: 'entity_type',
                    data: {
                        entity_type_name: entityTypeName,
                        description: description
                    }
                };

                try {
                    let response = await api.call('PUT', payload, '/adapi/');
                    if (response && response.message) {
                        kasa.info(response.message);
                    } else {
                        kasa.error('Failed to save entity type.');
                    }
                } catch (error) {
                    kasa.error(`Error: ${error}`);
                }finally {
                    loadEntities()
                }

            amodal.hide();
        });

            // add entity button
        //    $('#').click(function() {
                
        //         amodal.setTitleText("NEW ENTITY TYPE")
        //         amodal.setBodyHtml(`
        //         <div class="container mt-4">
        //                     <div class="card">
        //                         <div class="card-header">
        //                         <h5>Entity Type Information</h5>
        //                         </div>
        //                         <div class="card-body">
        //                         <form>
        //                             <div class="mb-3">
        //                             <label for="entityTypeName" class="form-label">Entity Type Name</label>
        //                             <input type="text" class="form-control" id="entityTypeName" name="entity_type_name" required>
        //                             </div>

        //                             <div class="mb-3">
        //                             <label for="entityDescription" class="form-label">Description</label>
        //                             <textarea class="form-control" id="entityDescription" name="description" rows="3"></textarea>
        //                             </div>
        //                         </form>
        //                         </div>
        //                         </div>
        //                     </div>
        //         `)
        //         amodal.setFooterHtml(`<button id="save_entity_type" class="btn btn-success w-100">SAVE</button>`)
        //         amodal.show()
        //         amodal.setSIZE('L')

              


        //     })
        //     // add company button
             $('#add_company').click(async function() {
                
                let entities = null;
                // Fetch entity types from the API
                //  to populate a entity type select dropdown
                let response  = await api.v2('VIEW', {'module': 'entity_type', 'data': {}}, '/adapi/').then(
                    response => {entities = response.message}
                ).catch(error => {
                    kasa.error(`Error fetching entity types: ${error}`);
                });
                // map api response with form select options
                // let entityOptions = entities.map(e => ({
                //         val: e.pk,
                //         desc: e.name || e.entity_type_name // use the correct field from your backend
                // }));
                // let enitity_select = fom.selectv2('entity', entityOptions, 'Select Entity Type', 'form-select form-select-sm', true);
                
                amodal.setTitleText("NEW COMPANY")
                amodal.setBodyHtml(`<div class="container mt-4">
                                        <div class="card">
                                            <div class="card-header">
                                            <h5>Company Information</h5>
                                            </div>
                                            <div class="card-body">
                                            <form>
                                                <div class="mb-3">
                                                    ${fom.text("companyName",'',  true)}
                                                </div>

                                                <div>
                                                    
                                                </div>

                                                <div class="mb-3">
                                                   ${fom.text("companyAddress", '', true)}
                                                </div>

                                                <div class="mb-3">
                                                     ${fom.email("companyEmail", '', true)}
                                                </div>

                                                <div class="mb-3">
                                                    ${fom.phone("companyPhone", '', true)}
                                                </div>

                                            </form>
                                            </div>
                                        </div>
                                        </div>
                `)
                amodal.setFooterHtml(`<button id="save_company" class="btn btn-success w-100">SAVE</button>`)
                amodal.show()
                amodal.setSIZE('L')

                

            })
        })

        // This binds the click handler even if the button is added later
        //  save company button
        // This is the click handler for the save company button
        $(document).on('click', '#save_company', async function () {
            input = anton.Inputs(['companyName', 'companyAddress', 'companyEmail', 'companyPhone']);
           
            // check if inpu is valid
            if (anton.validateInputs(input)) {
                loader.show();
                let payload = {
                    module: 'company',
                    data: input
                };

                let response = await api.v2('PUT', payload, '/adapi/').then(resp => {
                    if (anton.IsRequest(resp)) {
                        console.log("correct");
                        kasa.success(resp.message);
                    } else {
                        console.log("eroor");
                        kasa.error(resp.message);
                    }
                    }).catch(error => {
                            kasa.error(`Error: ${error}`);
                    }).finally(() => {
                        loader.hide();
                        loadCompanies();
                    });

        
            }



            amodal.hide();
        });

        
    </script>
<!-- dynamically display enitites and company -->
    <script>
        function loadCompanies() {
            api.v2('VIEW', {module: 'company', data: {}}, '/adapi/').then(response => {
            if (anton.IsRequest(response) && response.message && response.message.length > 0) {
                console.log(response)
                let companies = response.message;
                let rows = companies.map(company => `
                    <tr data-pk="${company.pk}">
                        <td>${company.name}</td>
                        <td>
                            <div class="dropdown d-inline">
                                <button class="btn btn-sm btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1-${company.pk}"
                                    data-toggle="dropdown" aria-expanded="false">
                                    <i class="fa fa-bars">M</i>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1-${company.pk}">
                                    <li>
                                        <button class="dropdown-item delete-company" type="button" data-asset-no="${company.pk}" data-bs-toggle="modal">
                                            Delete
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item update-company" type="button" data-asset-no="${company.pk}" data-bs-toggle="modal">
                                            Update
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                `).join('');
                $('#companies-table-body').html(rows);
            } else {
                $('#companies-table-body').html('<tr><td colspan="2">No companies found.</td></tr>');
            }
        });
    }
        function loadEntities() {
    api.v2('VIEW', {module: 'entity_type', data: {}}, '/adapi/').then(response => {
        if (anton.IsRequest(response) && response.message && response.message.length > 0) {
            let entities = response.message;
            let rows = entities.map(e => `
                <tr>
                    <td>${e.name}</td>
                    <td><span class="badge bg-success">${e.company_name}</span></td>
                    <td>
                        <div class="dropdown d-inline">
                            <button class="btn btn-sm btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1-entity-${e.pk}"
                                data-toggle="dropdown" aria-expanded="false">
                                <i class="fa fa-bars">M</i>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1-entity-${e.pk}">
                                <li>
                                    <button class="dropdown-item delete-entity" type="button" data-asset-no="${e.pk}" data-bs-toggle="modal">
                                        Delete
                                    </button>
                                </li>
                                <li>
                                    <button class="dropdown-item update-entity" type="button" data-asset-no="${e.pk}" data-bs-toggle="modal">
                                        Update
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </td>
                </tr>
            `).join('');
            $('#entities-table-body').html(rows);
        } else {
            $('#entities-table-body').html('<tr><td colspan="3">No entities found.</td></tr>');
        }
    });
}
    </script>
    
{% endblock %}