{% extends 'reports/base.html' %}
{% load static %}

{% block reports %}

    <div class="card h-100">
        <div class="card-header" id="reportCardTitle">
            <button class="btn btn-info" onclick="phorm.newReportLegend()">NEW LEGEND</button>
        </div>
        <div class="card-body p-2 overflow-auto" id="reportCardBody">
            <div class="w-100 h-100 d-flex flex-wrap">
                {% for legend in legends %}
                    <!-- MEETINGS -->
                    <div class="dropdown m-2">
                      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton{{legend.pk}}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        {{ legend.pk }} {{ legend.name }}
                      </button>
                      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton{{ legend.pk }}">
                        {% if user.is_superuser %}
                          <a class="dropdown-item" onclick="phorm.newReportLegendSub({{ legend.pk }})" href="javascript:void(0)"><small>new sub</small></a>
                            <div class="dropdown-divider"></div>
                          {% endif %}
                          {% for sub in legend.subs %}
                            <a class="dropdown-item" onclick="{{ sub.action }}" href="javascript:void(0)">{{ sub.name }}</a>
                          {% endfor %}
                      </div>
                    </div>
                {% endfor %}
                <!-- MEETINGS -->
{#                <div class="dropdown m-2">#}
{#                  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">#}
{#                    1.0 MEETINGS#}
{#                  </button>#}
{#                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">#}
{#                    <a class="dropdown-item" onclick="meeting.reportForm()" href="javascript:void(0)">1.1 My Meetings</a>#}
{#                  </div>#}
{#                </div>#}

                <!-- CMMS -->
{#                <div class="dropdown m-2">#}
{#                  <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">#}
{#                    2.0 CMMS#}
{#                  </button>#}
{#                  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">#}
{#                    <a class="dropdown-item" onclick="reports.cmms_sales_customer()" href="javascript:void(0)">2.1 Sales Customers</a>#}
{#                  </div>#}
{#                </div>#}


            </div>
        </div>
        <div class="card-footer" id="reportCardFooter"></div>
    </div>


    <script>
      function search_service_by_text(){
        let ev = this.event;
        let key = ev.which;
        console.table(key);

        if(key === 13){
          // enter make payload
          let payload = {
            module:'search_service_by_text',
            data:{
              query:$('#search_service_by_text').val()
            }
          }

          let retrieve = api.call('VIEW',payload,'/cmms/api/');
          if(anton.IsRequest(retrieve)){
            // load
            let jobs = retrieve.message;
            let tr = "";
            for(let j =0; j < jobs.length; j++){
              let job = jobs[j];
              tr += `
                  <tr>
                    <td>${job['company']}</td>
                  <td>${job['date']}</td>
                  <td><a href='/cmms/servicing/card/${job['pk']}/'>${job['carno']}</a></td>

                  </tr>
                  
              `
            }

            document.getElementById('search_service_by_text_body').innerHTML = tr
            // $('#search_service_by_text_body').html(tr);
            console.table(jobs)
          } else {
            kasa.response(retrieve)
          }
        }
      }
      $(document).ready(function () {
        // Attach keypress event to the new input field
        $('#search_service_by_text').on('keypress', function (event) {
          if (event.which === 13) { // 13 is the Enter key
            alert('Enter key pressed! Value: ' + $(this).val());
            // You can also perform any other action here
          }
        });
      });
    </script>

{% endblock %}