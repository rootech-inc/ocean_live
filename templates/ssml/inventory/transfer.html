{% extends 'ssml/ssmlbase.html' %}
{% load static %}

{% block body %}

<div class="card-header">
    <div class="w-100 d-flex flex-wrap">
        <div class="w-50 d-flex flex-wrap align-content-center">
            <button class="btn btn-primary btn-sm ms-2" id="add_transfer"><i class="fa fa-plus"></i> ADD</button>
            <button class="btn btn-secondary btn-sm ms-2" id="prev_transfer"><i class="fa fa-arrow-left"></i></button>
            <button class="btn btn-secondary btn-sm ms-2" id="next_transfer"><i class="fa fa-arrow-right"></i></button>
            <button class="btn btn-info btn-sm ms-2" id="print_transfer"><i class="fa fa-print"></i> PRINT</button>
        </div>
        <div class="w-50 d-flex flex-wrap align-content-center justify-content-end">
            <button class="btn btn-primary btn-sm ms-2" id="send_transfer" title="Send"><i class="fa fa-check"></i></button>
            <button class="btn btn-success btn-sm ms-2" id="post_transfer" title="Post"><i class="fa fa-check"></i></button>
            <button class="btn btn-warning btn-sm ms-2" id="unpost_transfer" title="UNPOST"><i class="fa fa-undo"></i></button>
            <button class="btn btn-danger btn-sm ms-2" id="delete_transfer"><i class="fa fa-trash"></i> </button>
            <!-- INSERT_YOUR_CODE -->
            <button class="btn btn-outline-secondary btn-sm ms-2" title="Attachments" id="attach_transfer">
                <i class="fa fa-paperclip"></i>
            </button>
        </div>
    </div>
</div>
<div class="card-body p-0">
    <div class="container-fluid p-0">
        <div class="row bg-info p-3">
            <div class="col-sm-3">
                <div class="row mb-3">
                    <div class="col-sm-4"><label for="entry_no">Enter No.</label></div>
                    <div class="col-sm-8">
                        <input type="text" disabled id="entry_no" class="form-control form-control-sm rounded-0">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-4"><label for="entry_date">Date.</label></div>
                    <div class="col-sm-8">
                        <input type="date" disabled id="entry_date" class="form-control form-control-sm rounded-0">
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4"><label for="tran_type">Type</label></div>
                    <div class="col-sm-8">

                        <input type="text" disabled id="tran_type" class="form-control form-control-sm rounded-0">
                    </div>
                </div>
            </div>

            <div class="col-sm-3">
                <div class="row">
                    <div class="col-sm-4"><label for="loc_fr">From.</label></div>
                    <div class="col-sm-8 mb-3">
                        <input type="text" disabled id="loc_fr" class="form-control form-control-sm rounded-0">
                    </div>

                    <div class="col-sm-4"><label for="loc_to">To.</label></div>
                    <div class="col-sm-8 mb-3">
                        <input type="text" disabled id="loc_to" class="form-control form-control-sm rounded-0">
                    </div>

                <!-- REMARKs -->
                    <div class="col-sm-4"><label for="remarks">Remarks</label></div>
                    <div class="col-sm-8"><input type="text" id="remarks" class="form-control form-control-sm rounded-0"></div>
                </div>
            </div>


            <div class="col-sm-3">
                <div class="row mb-3">
                    <div class="col-sm-4"><label for="created_by">Owner</label></div>
                    <div class="col-sm-8 mb-3"><input type="text" disabled id="created_by" class="form-control form-control-sm rounded-0"></div>

                    <div class="col-sm-4"><label for="delivered_by">Delivery</label></div>
                    <div class="col-sm-4"><input type="text" disabled id="delivered_by" class="form-control form-control-sm rounded-0"></div>
                    <div class="col-sm-4 mb-3"><input type="text" disabled id="car_no" class="form-control form-control-sm rounded-0"></div>

                    <div class="col-sm-4"><label for="approved_by">Approved</label></div>
                    <div class="col-sm-8 mb-3"><input type="text" disabled id="approved_by" class="form-control form-control-sm rounded-0"></div>

                </div>
            </div>

            <div class="col-sm-3">
                <div class="row">
                    <div class="col-sm-4"><label for="total_qty">QTY.</label></div>
                    <div class="col-sm-8 mb-3"><input type="text" disabled id="total_qty" class="form-control form-control-sm rounded-0"></div>

                    <div class="col-sm-4"><label for="total_amt">Total</label></div>
                    <div class="col-sm-8 mb-3"><input type="text" disabled id="total_amt" class="form-control form-control-sm rounded-0"></div>

                    <div class="col-sm-4"><label for="status">Status</label></div>
                    <div class="col-sm-8 mb-3"><input type="text" disabled id="status" class="form-control form-control-sm rounded-0"></div>


                </div>
            </div>

        </div>

        <div class="w-100 overflow-auto bg-dark-light table-responsive" style="height: 60vh!important">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th>LN</th>
                        <th>BARCODE</th>
                        <th>NAME</th>
                        <th>PACKING</th>
                        <th>PACK QTY</th>
                        <th>SENT QTY</th>
                        <th>REC. QTY</th>
                        <th>TOTAL</th>
                    </tr>
                </thead>
                <tbody id="tran_table">
                   <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                   </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    $(document).ready(function(){
        ssml.loadTransfer('{{last_entry}}')

        $('#send_transfer').click(function(){
            let conf = confirm("Are You Sure?");
            if(conf){
                let form = `
                    <label for='driver'>Driver</label>
                    <input class='form-control mb-2' id='driver'>
                    <label for='car_no'>Car No.</label>
                    <input class='form-control mb-2' id='car_no'>
                `;

                amodal.setBodyHtml(form)
                amodal.setFooterHtml(`<button id='send_id' class='btn btn-success rounded-0'>SEND</button>`)
                amodal.show()

                $('#send_id').click(function(){
                    let ids = ['entry_no','car_no','driver','mypk'];
                    if(anton.validateInputs(ids)){
                        let payload = {
                            module:'send_transfer',
                            data:anton.Inputs(ids)
                        }
                        kasa.confirm(api.call('PATCH',payload,'/ssml/api/')['message'],1,'here')
                    } else {
                        kasa.error("Please Fill Form")
                    }
                })
            } else {
                kasa.info("Operation Canceled")
            }
        })

        $('#post_transfer').click(function(){
            if(confirm('Are You Sure?')){
                let entry_no = $('#entry_no').val();
                ssml.postTransfter(entry_no)
            } else {
                kasa.info("Operation Canceled")
            }
        })

        $('#unpost_transfer').click(function(){
            if(confirm('Are You Sure?')){
                let entry_no = $('#entry_no').val();
                ssml.unpostTransfter(entry_no)
            } else {
                kasa.info("Operation Canceled")
            }
        })

        $('#add_transfer').click(function(){
            location.href = '/ssml/inventory/transfer/add/'
        })

        $('#print_transfer').click(function(){
            ssml.printTR($('#entry_no').val())
        })

        $('#prev_transfer').click(function(){
            let id = $(this).data('id')
            ssml.loadTransfer(id)
        })

        $('#next_transfer').click(function(){
            let id = $(this).data('id')
            ssml.loadTransfer(id)
        })

        $('#delete_transfer').click(function(){
            if(confirm("Are you sure?")){
                let entry_no = $('#entry_no').val();
                
                let payload = {
                    module:'delete_transfer',
                    data:{
                        entry_no:entry_no,
                        mypk:$('#mypk').val()
                    }

                    
                }
                kasa.confirm(api.call('DELETE',payload,'/ssml/api/')['message'],1,'here')
                
            } else {
                kasa.info("Operation Cancelled")
            }
            
        })

        
    })
</script>

{% endblock %}