{% extends 'ssml/ssmlbase.html' %}

{% load static %}

{% block body %}

    <style>
        .token-input{
            width: 40px;
            height: 40px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;

            font-size: 16px;
        }
    </style>

    <div id="content">

    </div>



    <script>

        let stage = cookies.getCookie('stage')
        console.log(stage)

        let legend1 =  `
            <h1 class="mt-4">Contractor Dashboard</h1>

        <!-- Statistics Cards -->
        <div class="row g-3 my-2 text-center">
            <div class="col-md-3">
                <div class="p-3 bg-white shadow-sm d-flex justify-content-around align-items-center rounded">
                    <div>
                        <h3 class="fs-2">230</h3>
                        <p class="fs-5">Total Issued</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-3 bg-white shadow-sm d-flex justify-content-around align-items-center rounded">
                    <div>
                        <h3 class="fs-2">92%</h3>
                        <p class="fs-5">Installed</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-3 bg-white shadow-sm d-flex justify-content-around align-items-center rounded">
                    <div>
                        <h3 class="fs-2">15</h3>
                        <p class="fs-5">Pending</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-3 bg-white shadow-sm d-flex justify-content-around align-items-center rounded">
                    <div>
                        <h3 class="fs-2">0.00</h3>
                        <p class="fs-5">Total Earnings</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="row my-5">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Monthly Work Progress
                    </div>
                    <div class="card-body">
                        <canvas id="workProgressChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Work Distribution
                    </div>
                    <div class="card-body">
                        <canvas id="workDistributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Work Records Table -->
        <div class="row my-5">
            <div class="col">
                <div class="card">
                    <div class="card-header">
                        Recent Work Records
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                            <thead>
                            <tr>
                                <th>Work ID</th>
                                <th>Type</th>
                                <th>Location</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Amount</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>W001</td>
                                <td>Installation</td>
                                <td>Sector 1</td>
                                <td>Completed</td>
                                <td>2024-01-15</td>
                                <td>₹5,000</td>
                            </tr>
                            </tbody>
                        </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        `

        let auth_html = `
            <div class="container-fluid h-100">
      <div class="row d-flex flex-column justify-content-center align-items-center h-100">
        <div class="col-sm-8 col-md-4 col-sm-offset-2 col-md-offset-4">
          <div class="card panel-default" style="border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.08); overflow:hidden;">
            <div class="card-body text-center" style="padding:30px;">
              <div style="margin-bottom:18px;">
                <img src="" alt="logo" class="img-responsive center-block" style="max-width:110px;">
              </div>

              <div style="margin-bottom:14px;">
                <h4 class="text-muted" style="margin:0 0 6px;">Sign in with your phone</h4>
                <p class="text-muted" style="font-size:13px; margin:0;">We'll send a one-time code to verify your number</p>
              </div>

              <div class="form-group" style="margin-top:18px;">
                <div class="input-group input-group-lg">
                  <span class="input-group-addon"><i class="glyphicon glyphicon-phone"></i></span>
                  <input
                    id="phone"
                    class="form-control rounded-0"
                    type="tel"
                    inputmode="numeric"
                    pattern="\d{10}"
                    placeholder="10-digit phone number"
                    maxlength="10"
                    required
                    oninput="this.value=this.value.replace(/\D/g,'').slice(0,10);document.getElementById('sendCode').disabled=this.value.length!==10;">
                </div>
                <div class="help-block text-left" style="margin-top:8px; font-size:12px; color:#777;">
                  Enter digits only — example: 0244123456
                </div>
              </div>

              <div class="form-group" style="margin-top:18px;">
                <button id="sendCode" class="btn btn-primary btn-lg btn-block" type="button" disabled onclick="/* handle send OTP */">
                  Send OTP
                </button>
              </div>

              <div style="margin-top:12px; font-size:12px; color:#999;">
                By continuing you agree to our <a href="#" style="color:inherit; text-decoration:underline;">Terms & Privacy</a>.
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
        `;

        let token_code = `
             <div class="container h-100">
              <div class="row justify-content-center h-100 d-flex align-items-center">
                <div class="col-md-6 col-lg-4">
                  <div class="card shadow-sm" style="border-radius:16px;">
                    <div class="card-body p=2 text-center p-4">
                      <h5 class="mb-3">Enter OTP</h5>
                      <p class="text-muted mb-4" style="font-size:14px;">We sent you a 6-digit OTP</p>

                      <div class="d-flex flex-wrap justify-content-between overflow-hidden">
                        <input type="password" class="form-control token-input" maxlength="1">
                        <input type="password" class="form-control token-input" maxlength="1">
                        <input type="password" class="form-control token-input" maxlength="1">
                        <input type="password" class="form-control token-input" maxlength="1">
                        <input type="password" class="form-control token-input" maxlength="1">
                        <input type="password" class="form-control token-input" maxlength="1">
                      </div>

                    </div>
                  </div>
                </div>
              </div>
            </div>
        `

        if(stage === 'auth'){
            $('#content').html(auth_html)
        } else if(stage === 'verify_token'){
            $('#content').html(token_code)
        }



        $('#sendCode').click(async function(){
            let phone = $('#phone').val()
            await ssml.focGetOTP(phone).then(res => {
                if(anton.IsRequest(res)){

                    cookies.setCookie('stage','verify_token',1)
                    cookies.setCookie('phone',phone,1)
                    $('#content').html(token_code)
                } else {
                    kasa.response(res)
                }
            }).catch(error => {
                kasa.info(error)})
        })


        $(document).ready(function(){
          $('.token-input').on('input', function(){
            this.value = this.value.replace(/[^0-9]/g,''); // digits only
            if(this.value.length === 1){
              $(this).next('.token-input').focus();
            }
            // if it's the last input and filled, trigger function
            if($(this).is(':last-child') && this.value.length === 1){
              verifyToken();
            }
          });

          $('.token-input').on('keydown', function(e){
            if(e.key === "Backspace" && this.value === ''){
              $(this).prev('.token-input').focus();
            }
          });
        });

        function verifyToken(){
          let code = '';
          $('.token-input').each(function(){
            code += $(this).val();
          });
          if(code.length === 6){
            alert("Entered Code: " + code);
            // you can replace with AJAX call
          }
        }

    </script>

{% endblock %}